<!DOCTYPE HTML>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
div.sticky {
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  background-color: yellow;
  padding: 50px;
  font-size: 20px;
}
</style>

<head>
Collocations
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<!-- <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" /> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script> -->
</head>

<body>
<h2>Sticky Element: Scroll Down to See the Effect</h2>
<p>Scroll down this page to see how  sticky positioning works.</p>
<div class="sticky">Lemma selection:
<!-- <select class="js-example-basic-single" id="lemmas_select" onchange="lemma_selected()"> </select> -->
<input id="lemmas_select" onchange="lemma_selected()">
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Algo Selection: <select id="algo_select" onchange="change_algo_by_user()"></select>
<p id="other_lemmas"></p>
</div>

<p id="table_header"> </p>
<h2>Scroll back up again to "remove" the sticky position.</h2>
<a href="javascript:void(0);" onClick="new_lemma_selection_from_link('litus')"> fdfd </a>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus imperdiet, nulla et dictum interdum, nisi lorem egestas odio, vitae scelerisque enim ligula venenatis dolor. Maecenas nisl est, ultrices nec congue eget, auctor vitae massa. Fusce luctus vestibulum augue ut aliquet. Mauris ante ligula, facilisis sed ornare eu, lobortis in odio. Praesent convallis urna a lacus interdum ut hendrerit risus congue. Nunc sagittis dictum nisi, sed ullamcorper ipsum dignissim ac. In at libero sed nunc venenatis imperdiet sed ornare turpis. Donec vitae dui eget tellus gravida venenatis. Integer fringilla congue eros non fermentum. Sed dapibus pulvinar nibh tempor porta. Cras ac leo purus. Mauris quis diam velit.</p>

</body>
<script>	
	var ref_loader = $.getJSON({'url': "https://raw.githubusercontent.com/danelh/collocations/master/ref.json", 'async': true});
	var all_lemmas;
	var current_lemma_json;
	var current_lemma="";
	var supported_algos = [];
	var current_algo = "";
	var supported_algo_index = -1;
	var user_clicked_browser = false
	ref_loader.done(function(){
		all_lemmas = ref_loader.responseJSON;		
		init();}
	);	
	
	function init(){
		//all_words_sorted_list = get_all_words_sorted_list();
		console.log("count: " + Object.keys(all_lemmas).length);
		//update_params_from_url();
		//console.log("to: " + to);
		//console.log("from: " + from);
		//playing_list = all_words_sorted_list.slice(from, to);
		fill_algos();
		init_keyboard_clicks();
		fire_from_url();
		init_url_change();
		//next();
		// Try this link for fast loading
		//https://chrissmith.xyz/lightning-fast-filtering-in-javascript/
		// https://stackoverflow.com/questions/9639703/ie8-javascript-very-slow-to-load-large-list-of-options-in-select-element
	}
	
	function fire_from_url(){
		load_params_from_url();
		if (current_lemma){
			// call lemma as user selection
			lemma_selected();
		}
	}
	
	function init_url_change(){
		window.addEventListener('popstate', function(){
			console.log('popstate changed!');
			user_clicked_browser = true
			fire_from_url();			
		})
	}
	
	function fill_algos(){
		algos_list = ["w1", "w2", "w3", "w4", "w6", "w8",
					  "r1", "r2", "r3", "r4", "r6", "r8", "r12", "r16"];
		
		var algo_select = document.getElementById("algo_select");
		for (i=0; i < algos_list.length; i += 1){
			var option = document.createElement("option");
			option.text = algos_list[i];
			algo_select.add(option)
		}
	}
	
	/*
	function fill_lemmas(){
		$(document).ready(function() {
			$('.js-example-basic-single').select2();
		});
		var lemmas_select =  document.getElementById("lemmas_select");
		for(var key in all_lemmas){
			var option = document.createElement("option");
			option.text = key;
			option.value = key;
			lemmas_select.add(option);
		} 
	}*/

	// Instead of 2 button (method + number): I think to have them all in one selector
	function init_keyboard_clicks(){
		document.addEventListener("keydown", function(event) {
		var x = event.which || event.keyCode;
		if (x === 39){
			// when we have only one no toggle
			if (supported_algos.length > 1){
				supported_algo_index = (supported_algo_index + 1) % supported_algos.length;
				//console.log(supported_algo_index);
				update_current_algo(supported_algos[supported_algo_index]);
			}
			else if ((supported_algos.length == 1) && (supported_algo_index == -1)){
				supported_algo_index = 0;
				update_current_algo(supported_algos[0])
			}
			//console.log("right");
		}
		else if (x === 37){		
			// when we have only one no toggle
			if (supported_algos.length > 1){
				// % of negative is negative. WTF. 
				if (supported_algo_index <= 0)
				{
					supported_algo_index = supported_algos.length - 1;
				}
				else{
					supported_algo_index = (supported_algo_index - 1) % supported_algos.length;
				}
				update_current_algo(supported_algos[supported_algo_index]);
			}
			else if ((supported_algos.length == 1) && (supported_algo_index == -1)){
				supported_algo_index = 0;
				update_current_algo(supported_algos[0])
			}
			//console.log("right");

		}
		else if (x === 32){		
			console.log("space");
		}

	//	else if (x === 38){		
	//		console.log("up");
	//	}
	//	else if (x === 40){		
	//		console.log("down");
	//	}
	// https://keycode.info/
	//	else if (x === 13){		
	//		console.log("Enter");
	//	}

		

	 
		});
	}
	
	function new_lemma_selection_from_link(new_lemma){
		document.getElementById("lemmas_select").value = new_lemma;
		lemma_selected();
	}
	
	function new_algo_selection_from_link(new_algo){
		console.log("here");
		document.getElementById("algo_select").value = new_algo;
		change_algo_by_user();
	}
	
	function lemma_selected(){
		get_lemma_from_user_input();
		console.log(current_lemma);		
		fetch_lemma(current_lemma);
	}
	
	function get_lemma_path(lemma){
		var first = lemma[0];
		var _second = lemma[0];
		if (lemma.length > 1){
			_second = lemma[1];
		}
		var second = first + _second;
		
		s = "https://raw.githubusercontent.com/danelh/collocations/master/data/" + first + "/" + second + "/" + lemma + ".json";
		return s;
	}
	
	function display_current_lemma(){
		console.log(current_lemma_json);
		process_lemma_display();
	}
	
	function fetch_lemma(lemma){		
		path = get_lemma_path(lemma);
		if (lemma in all_lemmas){
			var lemma_loader = $.getJSON({'url': path, 'async': true});
			lemma_loader.done(function(){
			current_lemma_json = lemma_loader.responseJSON;		
			display_current_lemma();}
			);
		}
		else{
			display_current_lemma();
		}
	}
	
	function process_lemma_display(){
		get_supported_algos_for_lemma(ui);
		console.log(supported_algos);		
		na = get_numeric_alternatives(current_lemma)
		console.log(na);
		if (na.length > 0){
			update_other_lemmas(na);
		}
		else if (supported_algos.length == 0){			
			update_other_lemmas(get_did_you_mean(current_lemma));
		}
		else {
			// we have a match, and no alternatives:
			document.getElementById("other_lemmas").innerHTML = "";
		}
		
		update_table_header();
		get_current_selected_algo();
		update_url_params();
		update_table();
				
	}
	
	function get_current_selected_algo(){		
		current_algo = document.getElementById("algo_select").value;
		supported_algo_index = supported_algos.indexOf(current_algo);
	}
	
	function change_algo_by_user(){
		console.log("here");
		algo = document.getElementById("algo_select").value;
		update_current_algo(algo);
		// because we don't want the arrow-key to be relevent for this feature anymore
		document.getElementById("algo_select").blur()
	}
	
	function update_current_algo(algo){
		current_algo = algo;
		document.getElementById("algo_select").value = algo;
		supported_algo_index = supported_algos.indexOf(current_algo);
		update_url_params();
		if (supported_algos.length > 0){
			update_table();
		}
		
	}
	
	function update_table(){
		console.log("u:" + current_algo);
		//console.log(current_lemma_json);
	}
	
	function update_other_lemmas(others){
		
		txt = ""
		if (!(current_lemma in all_lemmas)){
			txt = "Could not find \"" + current_lemma + "\", consider: ";
		}
		else{			
			txt = "Consider also: ";
		}
		for (i=0; i < others.length; i+=1){			
			txt += get_href_for_new_lemma(others[i]);;
			if (i != others.length - 1){
				txt += ",";
			}
		}
		document.getElementById("other_lemmas").innerHTML = txt;
	}
	
	function get_href_for_new_lemma(new_lemma){
		return "<a href=\"javascript:void(0);\" onClick=\"new_lemma_selection_from_link('" + new_lemma + "')\">" + new_lemma + "</a>"; 
	}
	
	function get_href_for_new_algo(new_algo){		
		return "<a href=\"javascript:void(0);\" onClick=\"new_algo_selection_from_link('" + new_algo + "')\">" + new_algo + "</a>"; 
	}

	
	function get_did_you_mean(lemma){
		res = [];
		for(var key in all_lemmas){
			if (1 == get_lev_distance(lemma, key)){
				res.push(key);
			}
		}
		
		return res;
	}
	
	function get_lemma_from_user_input(){
		var lemmas_select =  document.getElementById("lemmas_select");
		ui = lemmas_select.value;		
		ui = ui.replace("j", "i");
		ui = ui.replace("v", "u");
		current_lemma = ui;
	}
	
	function get_supported_algos_for_lemma(lemma){
		supported_algos = []
		if (!(lemma in all_lemmas)){
			return []
		}else{			
			for(var key in current_lemma_json){
				
				if (!is_empty(current_lemma_json[key])){				
					supported_algos.push(key)
				}
			}
		}		
	}
	
	function get_numeric_alternatives(lemma){
		res = []
		_lemma = lemma
		var last_char = _lemma[_lemma.length -1];
		if ((is_numeric(last_char)) && (_lemma.length > 1)){
			_lemma = _lemma.slice(0, -1); 
			if (_lemma in all_lemmas){
				res.push(_lemma);
			}
		}
		
		for (i=0; i <=9; i+=1){
			candidatae = _lemma+String(i);
			console.log(candidatae);
			if ((candidatae in all_lemmas) && (candidatae != lemma)){
				res.push(candidatae);
			}
		}
		
		return res;
	}
	
	function update_table_header(){
		// for header:
		// no supported algos: No match.
		// supported: print supported
		txt = "";
		if (!(current_lemma in all_lemmas)){
			txt = "No algos for the selected lemma";
		}
		else
		{
			for (i=0; i < supported_algos.length; i+=1){
				//txt += supported_algos[i]
				txt += get_href_for_new_algo(supported_algos[i]);
				if (i != supported_algos.length - 1){
					txt += ",";
				}
			}
		}

		document.getElementById("table_header").innerHTML = "Supported algos: " + txt + " click right (→) and left (←) arrows to toggle";
	}
	
	function update_url_params(){		
		var url_string = window.location.href
		var url = new URL(url_string);
		if (current_lemma){			
			url.searchParams.set("lemma", current_lemma);
		}
		if (current_algo){			
			url.searchParams.set("algo", current_algo);
		}
		if (!user_clicked_browser)
		{
			// replaceState if only algo has changed. we don't want to fill the history. we want efficient back
			// also, you can toggle with arrows the algo.
			url_lemma = get_param_from_url("lemma");
			if (url_lemma != current_lemma){
				window.history.pushState('updated params', '', url.toString());
			}
			else{
				window.history.replaceState('updated params', '', url.toString());
			}
		}
		else{
			// init here - because async
			user_clicked_browser = false
		}
    }
	
	function load_algo_from_url(){
		algo = get_param_from_url("algo");
		if (algo){
			document.getElementById("algo_select").value = algo;
			_current_algo = document.getElementById("algo_select").value;
			// not in algo list -> do nothing
			if (algo != _current_algo){
				document.getElementById("algo_select").selectedIndex =0;			
			}else{
				current_algo = _current_algo;
			}
		}		
	}
	
	function load_lemma_from_url(){
		lemma = get_param_from_url("lemma");
		if (lemma){
			document.getElementById("lemmas_select").value = lemma;
			current_lemma = lemma;
		}
	}
	
	function load_params_from_url(){
		load_algo_from_url();
		load_lemma_from_url();
	}
	
	function get_param_from_url(param){
		var url_string = window.location.href
		var url = new URL(url_string);
		var c = url.searchParams.get(param);
		return c;
    }



	
	// https://en.wikibooks.org/wiki/Algorithm_Implementation/Strings/Levenshtein_distance#JavaScript
	function get_lev_distance(a, b) {
		
		if (a.length === 0) return b.length; 
		if (b.length === 0) return a.length;

		var matrix = [];

		// increment along the first column of each row
		var i;
		for (i = 0; i <= b.length; i++) {
			matrix[i] = [i];
		}

		// increment each column in the first row
		var j;
		for (j = 0; j <= a.length; j++) {
			matrix[0][j] = j;
		}

		// Fill in the rest of the matrix
		for (i = 1; i <= b.length; i++) {
			for (j = 1; j <= a.length; j++) {
				if (b.charAt(i-1) == a.charAt(j-1)) {
					matrix[i][j] = matrix[i-1][j-1];
				} else {
					matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, // substitution
										Math.min(matrix[i][j-1] + 1, // insertion
												 matrix[i-1][j] + 1)); // deletion
				}
			}
		}

		return matrix[b.length][a.length];
	}
	
	function is_numeric(c){
		return (c >= '0' && c <= '9')
	}
	
	function is_empty(obj) {
		return Object.keys(obj).length === 0;
	}


</script>
</html>
